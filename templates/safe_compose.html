<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Safe Compose | CyberShield</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=VT323&display=swap" rel="stylesheet">
<style>
:root {
    --beige-light: #F0EDE0;
    --beige-main: #E0DCCF;
    --beige-dark: #C4C0B3;
    --beige-shadow: #A09C8F;
    --screen-black: #1a1d21;
    --crt-green: #4af626;
    --ink-black: #0f0f0f;
    --font-serif: 'EB Garamond', serif;
    --font-mono: 'VT323', monospace;
    --zone-safe: #2d6a4f;
    --zone-uncertain: #b08c1a;
    --zone-moderate: #c05621;
    --zone-high: #9b2226;
    --glow-safe: rgba(45, 106, 79, 0.15);
    --glow-warn: rgba(176, 140, 26, 0.15);
    --glow-danger: rgba(155, 34, 38, 0.2);
}
@font-face { font-family: 'RetroSerif'; src: local('Apple Garamond'), local('Garamond'), local('Times New Roman'); }
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background-color: #f4f1e6; font-family: 'RetroSerif', serif; color: var(--ink-black); min-height: 100vh; line-height: 1.6; transition: background-color 0.5s ease; }

/* Dynamic background glow */
body.zone-safe { background-color: #f4f1e6; }
body.zone-uncertain { background-color: #f7f3e2; }
body.zone-moderate { background-color: #f9f0de; }
body.zone-high { background-color: #fceae8; }

/* Island Navbar */
.island-nav { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; align-items: center; gap: 6px; padding: 10px 14px; background: rgba(228,224,212,0.55); backdrop-filter: blur(18px) saturate(160%); -webkit-backdrop-filter: blur(18px) saturate(160%); border: 1px solid rgba(160,156,143,0.45); border-radius: 50px; box-shadow: 0 4px 24px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.5); }
.island-nav .nav-brand { font-family: var(--font-mono); font-size: 1.1rem; color: var(--ink-black); padding: 6px 14px; letter-spacing: 1px; border-right: 1px solid rgba(160,156,143,0.4); margin-right: 4px; white-space: nowrap; text-decoration: none; }
.island-nav .nav-link { font-family: 'RetroSerif', serif; font-size: 1.05rem; color: #555; text-decoration: none; padding: 7px 16px; border-radius: 30px; transition: all 0.25s ease; white-space: nowrap; }
.island-nav .nav-link:hover { background: rgba(15,15,15,0.07); color: var(--ink-black); }
.island-nav .nav-link.active { background: var(--ink-black); color: #f4f1e6; }
.island-nav .nav-link.cta-link { background: var(--ink-black); color: #f4f1e6; font-family: var(--font-mono); font-size: 0.95rem; letter-spacing: 0.5px; margin-left: 2px; }
.island-nav .nav-link.cta-link:hover { background: #333; color: #fff; }

.main-layout { max-width: 750px; margin: 0 auto; padding: 6rem 2rem 3rem; }

.page-header { text-align: center; margin-bottom: 2.5rem; }
.page-header h1 { font-size: 4rem; font-weight: 400; font-family: 'RetroSerif', serif; margin-bottom: 0.6rem; letter-spacing: -2px; line-height: 1; }
.page-header .subtitle { color: #666; font-size: 1.15rem; font-family: 'RetroSerif', serif; max-width: 550px; margin: 0 auto; line-height: 1.4; }

/* === Tweet Compose Card === */
.compose-card {
    background: var(--beige-light);
    border: 2px solid var(--beige-dark);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 3px 3px 0 var(--beige-dark);
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
    position: relative;
    overflow: hidden;
}
.compose-card.danger {
    border-color: var(--zone-high);
    box-shadow: 3px 3px 0 var(--zone-high), 0 0 30px rgba(155,34,38,0.12);
}
.compose-card.warning {
    border-color: var(--zone-uncertain);
    box-shadow: 3px 3px 0 var(--zone-uncertain), 0 0 20px rgba(176,140,26,0.1);
}

.compose-top {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 1rem;
}

.compose-avatar {
    width: 48px; height: 48px; border-radius: 50%;
    background: var(--ink-black);
    display: flex; align-items: center; justify-content: center;
    font-family: var(--font-mono); color: #f4f1e6; font-size: 1.3rem;
    flex-shrink: 0;
}

.compose-body { flex: 1; }

.compose-textarea {
    width: 100%;
    min-height: 120px;
    background: transparent;
    border: none;
    outline: none;
    font-family: 'RetroSerif', serif;
    font-size: 1.25rem;
    color: var(--ink-black);
    resize: vertical;
    line-height: 1.5;
    padding: 8px 0;
}
.compose-textarea::placeholder { color: var(--beige-shadow); }

/* Highlighted preview */
.highlight-preview {
    display: none;
    min-height: 40px;
    padding: 8px 0;
    font-family: 'RetroSerif', serif;
    font-size: 1.25rem;
    line-height: 1.5;
    word-wrap: break-word;
    margin-bottom: 0.5rem;
}
.highlight-preview .toxic-word {
    background: rgba(155,34,38,0.18);
    color: var(--zone-high);
    padding: 2px 4px;
    border-radius: 4px;
    border-bottom: 2px solid var(--zone-high);
    font-weight: 600;
}

/* Character count */
.compose-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid var(--beige-dark);
    padding-top: 1rem;
    margin-top: 0.5rem;
}

.char-count {
    font-family: var(--font-mono);
    font-size: 0.95rem;
    color: var(--beige-shadow);
}

.compose-actions {
    display: flex;
    gap: 8px;
}

.btn-post {
    padding: 10px 24px;
    border-radius: 50px;
    border: 2px solid var(--ink-black);
    background: var(--ink-black);
    color: #f4f1e6;
    font-family: var(--font-mono);
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.3s;
}
.btn-post:hover { background: #333; }
.btn-post:disabled { opacity: 0.4; cursor: not-allowed; }

.btn-rewrite {
    padding: 10px 20px;
    border-radius: 50px;
    border: 2px solid var(--zone-high);
    background: rgba(155,34,38,0.08);
    color: var(--zone-high);
    font-family: var(--font-mono);
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.3s;
    display: none;
    animation: fadeSlideIn 0.4s ease;
}
.btn-rewrite:hover { background: rgba(155,34,38,0.15); transform: scale(1.03); }
.btn-rewrite.visible { display: inline-flex; align-items: center; gap: 6px; }

@keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* === Live Toxicity Meter === */
.meter-section {
    margin-top: 1.5rem;
    margin-bottom: 2rem;
}

.meter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.6rem;
}

.meter-label {
    font-family: var(--font-mono);
    font-size: 1rem;
    letter-spacing: 0.5px;
    color: #888;
}

.meter-score {
    font-family: var(--font-mono);
    font-size: 2rem;
    font-weight: 700;
    transition: color 0.4s ease;
}
.meter-score.safe { color: var(--zone-safe); }
.meter-score.uncertain { color: var(--zone-uncertain); }
.meter-score.moderate { color: var(--zone-moderate); }
.meter-score.high { color: var(--zone-high); }

.meter-bar-bg {
    width: 100%;
    height: 12px;
    background: #e8e5d8;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid var(--beige-dark);
}

.meter-bar {
    height: 100%;
    width: 0%;
    border-radius: 5px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), background 0.5s ease;
}
.meter-bar.safe { background: linear-gradient(90deg, #2d6a4f, #40916c); }
.meter-bar.uncertain { background: linear-gradient(90deg, #b08c1a, #d4a91a); }
.meter-bar.moderate { background: linear-gradient(90deg, #c05621, #e07832); }
.meter-bar.high { background: linear-gradient(90deg, #9b2226, #d32f2f); }

.meter-zones {
    display: flex;
    justify-content: space-between;
    margin-top: 4px;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: #aaa;
}

/* Zone badge */
.zone-badge {
    display: inline-block;
    padding: 4px 14px;
    border-radius: 20px;
    font-family: var(--font-mono);
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 1px;
    border: 2px solid;
    transition: all 0.4s ease;
}
.zone-badge.safe { background: rgba(45,106,79,0.1); color: var(--zone-safe); border-color: var(--zone-safe); }
.zone-badge.uncertain { background: rgba(176,140,26,0.1); color: var(--zone-uncertain); border-color: var(--zone-uncertain); }
.zone-badge.moderate { background: rgba(192,86,33,0.1); color: var(--zone-moderate); border-color: var(--zone-moderate); }
.zone-badge.high { background: rgba(155,34,38,0.1); color: var(--zone-high); border-color: var(--zone-high); }

/* === Analysis Panel === */
.analysis-panel {
    display: none;
    background: var(--screen-black);
    border-radius: 10px;
    padding: 1.2rem;
    margin-bottom: 1.5rem;
    box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
    animation: fadeSlideIn 0.4s ease;
}
.analysis-panel.visible { display: block; }
.analysis-panel h4 {
    font-family: var(--font-mono);
    color: var(--crt-green);
    font-size: 0.95rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 0.6rem;
}
.analysis-panel ul { list-style: none; }
.analysis-panel li {
    padding: 3px 0;
    display: flex;
    align-items: flex-start;
    gap: 8px;
    color: #aaa;
    font-family: var(--font-mono);
    font-size: 0.9rem;
}
.analysis-panel li::before { content: '‚Üí'; color: var(--crt-green); font-weight: 700; }

/* === Rewrite Result === */
.rewrite-result {
    display: none;
    margin-bottom: 1.5rem;
    animation: fadeSlideIn 0.4s ease;
}
.rewrite-result.visible { display: block; }

.rewrite-compare {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.rewrite-box {
    border-radius: 10px;
    padding: 1.2rem;
    border: 2px solid;
}
.rewrite-box.original {
    background: rgba(155,34,38,0.05);
    border-color: var(--zone-high);
}
.rewrite-box.rewritten {
    background: rgba(45,106,79,0.05);
    border-color: var(--zone-safe);
}
.rewrite-box h5 {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 0.6rem;
}
.rewrite-box.original h5 { color: var(--zone-high); }
.rewrite-box.rewritten h5 { color: var(--zone-safe); }
.rewrite-box p {
    font-family: 'RetroSerif', serif;
    font-size: 1.1rem;
    line-height: 1.5;
}
.rewrite-box .score-tag {
    display: inline-block;
    margin-top: 0.6rem;
    padding: 3px 10px;
    border-radius: 12px;
    font-family: var(--font-mono);
    font-size: 0.8rem;
    font-weight: 700;
}
.rewrite-box.original .score-tag { background: rgba(155,34,38,0.12); color: var(--zone-high); }
.rewrite-box.rewritten .score-tag { background: rgba(45,106,79,0.12); color: var(--zone-safe); }

.use-rewrite-btn {
    display: block;
    width: 100%;
    margin-top: 1rem;
    padding: 12px;
    background: var(--zone-safe);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-family: var(--font-mono);
    font-size: 1.05rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.3s;
}
.use-rewrite-btn:hover { background: #1b4332; transform: translateY(-2px); }

/* === Warning Banner === */
.warning-banner {
    display: none;
    background: rgba(155,34,38,0.08);
    border: 2px solid var(--zone-high);
    border-radius: 10px;
    padding: 1rem 1.2rem;
    margin-bottom: 1.5rem;
    text-align: center;
    animation: pulse 2s ease-in-out infinite;
}
.warning-banner.visible { display: block; }
.warning-banner p {
    font-family: var(--font-mono);
    font-size: 1rem;
    color: var(--zone-high);
    letter-spacing: 0.5px;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* === Example Chips === */
.examples-section {
    margin-top: 2rem;
    text-align: center;
}
.examples-section h4 {
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: #aaa;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 0.8rem;
}
.example-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
}
.example-chip {
    padding: 8px 16px;
    background: var(--beige-light);
    border: 1px solid var(--beige-dark);
    border-radius: 20px;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: #666;
    cursor: pointer;
    transition: all 0.3s;
}
.example-chip:hover { background: var(--beige-dark); color: var(--ink-black); transform: translateY(-2px); }

footer { padding: 2.5rem 6%; text-align: center; border-top: 1px solid var(--beige-dark); margin-top: 2rem; }
footer p { color: #999; font-size: 0.95rem; font-family: var(--font-mono); letter-spacing: 0.5px; }

@media (max-width: 768px) {
    .page-header h1 { font-size: 2.5rem; }
    .island-nav { top: 12px; padding: 8px 10px; gap: 2px; }
    .island-nav .nav-brand { display: none; }
    .island-nav .nav-link { font-size: 0.9rem; padding: 6px 10px; }
    .rewrite-compare { grid-template-columns: 1fr; }
    .compose-footer { flex-direction: column; gap: 10px; }
}
</style>
</head>
<body>

<nav class="island-nav">
    <a href="/" class="nav-brand">CYBERSHIELD</a>
    <a href="/" class="nav-link">Home</a>
    <a href="/features" class="nav-link">Features</a>
    <a href="/architecture" class="nav-link">Architecture</a>
    <a href="/ethics" class="nav-link">Ethics</a>
    <a href="/bully-ring" class="nav-link">Ring Detector</a>
    <a href="/kid-shield" class="nav-link">Kid Shield</a>
    <a href="/safe-compose" class="nav-link active">Safe Compose</a>
    <a href="/try" class="nav-link cta-link">Try It ‚ñ∏</a>
</nav>

<div class="main-layout">

    <div class="page-header">
        <h1>Safe Compose</h1>
        <p class="subtitle">Think before you tweet. Type your message below and watch CyberShield analyze it in real-time.</p>
    </div>

    <!-- Warning Banner -->
    <div class="warning-banner" id="warningBanner">
        <p>‚ö†Ô∏è THIS MESSAGE MAY VIOLATE COMMUNITY GUIDELINES ‚Äî CONSIDER REPHRASING</p>
    </div>

    <!-- Compose Card -->
    <div class="compose-card" id="composeCard">
        <div class="compose-top">
            <div class="compose-avatar">U</div>
            <div class="compose-body">
                <textarea class="compose-textarea" id="composeInput" placeholder="What's happening? Type a tweet to analyze..."></textarea>
                <div class="highlight-preview" id="highlightPreview"></div>
            </div>
        </div>
        <div class="compose-footer">
            <span class="char-count"><span id="charCount">0</span>/280</span>
            <div class="compose-actions">
                <button class="btn-rewrite" id="rewriteBtn">‚ú® Rewrite with Empathy</button>
                <button class="btn-post" id="postBtn">POST</button>
            </div>
        </div>
    </div>

    <!-- Live Meter -->
    <div class="meter-section">
        <div class="meter-header">
            <span class="meter-label">TOXICITY LEVEL</span>
            <div>
                <span class="meter-score safe" id="meterScore">0%</span>
                <span class="zone-badge safe" id="zoneBadge">SAFE</span>
            </div>
        </div>
        <div class="meter-bar-bg">
            <div class="meter-bar safe" id="meterBar"></div>
        </div>
        <div class="meter-zones">
            <span>SAFE</span>
            <span>UNCERTAIN</span>
            <span>MODERATE</span>
            <span>HIGH RISK</span>
        </div>
    </div>

    <!-- Analysis Panel -->
    <div class="analysis-panel" id="analysisPanel">
        <h4>Detection Analysis</h4>
        <ul id="explanationList"></ul>
    </div>

    <!-- Rewrite Result -->
    <div class="rewrite-result" id="rewriteResult">
        <div class="rewrite-compare">
            <div class="rewrite-box original">
                <h5>‚ùå Original</h5>
                <p id="originalText"></p>
                <span class="score-tag" id="originalScore">Score: 0%</span>
            </div>
            <div class="rewrite-box rewritten">
                <h5>‚úÖ Rewritten</h5>
                <p id="rewrittenText"></p>
                <span class="score-tag" id="newScore">Score: 0%</span>
            </div>
        </div>
        <button class="use-rewrite-btn" id="useRewriteBtn">‚Üë USE THIS VERSION</button>
    </div>

    <!-- Example Chips -->
    <div class="examples-section">
        <h4>Try These Examples</h4>
        <div class="example-chips">
            <div class="example-chip" data-text="You're such an idiot ü§¨">You're such an idiot ü§¨</div>
            <div class="example-chip" data-text="Go kill yourself trash ü§°">Go kill yourself trash ü§°</div>
            <div class="example-chip" data-text="Have a wonderful day! ‚ù§Ô∏è">Have a wonderful day! ‚ù§Ô∏è</div>
            <div class="example-chip" data-text="Nobody likes you, loser">Nobody likes you, loser</div>
            <div class="example-chip" data-text="Great work on this project!">Great work on this project!</div>
            <div class="example-chip" data-text="Shut up you worthless clown üñï">Shut up you worthless clown üñï</div>
        </div>
    </div>

</div>

<footer>
    <p>CyberShield Safe Compose ¬∑ Prevention Over Detection</p>
</footer>

<script>
const composeInput = document.getElementById('composeInput');
const charCount = document.getElementById('charCount');
const meterScore = document.getElementById('meterScore');
const meterBar = document.getElementById('meterBar');
const zoneBadge = document.getElementById('zoneBadge');
const analysisPanel = document.getElementById('analysisPanel');
const explanationList = document.getElementById('explanationList');
const composeCard = document.getElementById('composeCard');
const warningBanner = document.getElementById('warningBanner');
const rewriteBtn = document.getElementById('rewriteBtn');
const rewriteResult = document.getElementById('rewriteResult');
const highlightPreview = document.getElementById('highlightPreview');
const postBtn = document.getElementById('postBtn');

let debounceTimer = null;
let currentTriggers = [];
let lastRewrite = '';

// Real-time analysis on typing
composeInput.addEventListener('input', () => {
    const text = composeInput.value;
    charCount.textContent = text.length;

    // Debounce API call (300ms after typing stops)
    clearTimeout(debounceTimer);
    if (text.trim().length === 0) {
        resetMeter();
        return;
    }
    debounceTimer = setTimeout(() => analyzeLive(text), 300);
});

async function analyzeLive(text) {
    try {
        const resp = await fetch('/analyze-live', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
        });
        const data = await resp.json();
        updateMeter(data);
    } catch (e) {
        console.error('Analysis failed:', e);
    }
}

function updateMeter(data) {
    const score = data.score;
    const zone = data.zone || 'SAFE';
    const zoneClass = zone.toLowerCase();

    // Score display
    meterScore.textContent = score + '%';
    meterScore.className = 'meter-score ' + zoneClass;

    // Bar
    meterBar.style.width = Math.max(score, 2) + '%';
    meterBar.className = 'meter-bar ' + zoneClass;

    // Zone badge
    zoneBadge.textContent = zone;
    zoneBadge.className = 'zone-badge ' + zoneClass;

    // Body background
    document.body.className = 'zone-' + zoneClass;

    // Compose card state
    composeCard.className = 'compose-card';
    if (score >= 60) composeCard.classList.add('danger');
    else if (score >= 40) composeCard.classList.add('warning');

    // Warning banner
    if (data.is_bullying) {
        warningBanner.classList.add('visible');
    } else {
        warningBanner.classList.remove('visible');
    }

    // Rewrite button visibility
    if (score >= 30) {
        rewriteBtn.classList.add('visible');
    } else {
        rewriteBtn.classList.remove('visible');
        rewriteResult.classList.remove('visible');
    }

    // Analysis panel
    if (data.explanation && data.explanation.length > 0) {
        explanationList.innerHTML = data.explanation.map(e => `<li>${escapeHtml(e)}</li>`).join('');
        analysisPanel.classList.add('visible');
    } else {
        analysisPanel.classList.remove('visible');
    }

    // Word highlighting
    currentTriggers = data.triggers || [];
    if (currentTriggers.length > 0) {
        showHighlights(composeInput.value, currentTriggers);
    } else {
        highlightPreview.style.display = 'none';
    }
}

function showHighlights(text, triggers) {
    let html = escapeHtml(text);
    // Sort triggers longest first
    const sorted = [...triggers].sort((a, b) => b.length - a.length);
    for (const trigger of sorted) {
        const escaped = escapeHtml(trigger);
        const regex = new RegExp(escapeRegex(escaped), 'gi');
        html = html.replace(regex, `<span class="toxic-word">$&</span>`);
    }
    highlightPreview.innerHTML = html;
    highlightPreview.style.display = 'block';
}

function resetMeter() {
    meterScore.textContent = '0%';
    meterScore.className = 'meter-score safe';
    meterBar.style.width = '0%';
    meterBar.className = 'meter-bar safe';
    zoneBadge.textContent = 'SAFE';
    zoneBadge.className = 'zone-badge safe';
    document.body.className = 'zone-safe';
    composeCard.className = 'compose-card';
    warningBanner.classList.remove('visible');
    rewriteBtn.classList.remove('visible');
    analysisPanel.classList.remove('visible');
    rewriteResult.classList.remove('visible');
    highlightPreview.style.display = 'none';
}

// Empathy rewrite
rewriteBtn.addEventListener('click', async () => {
    const text = composeInput.value.trim();
    if (!text) return;

    rewriteBtn.textContent = '‚è≥ Rewriting...';
    rewriteBtn.disabled = true;

    try {
        const resp = await fetch('/rewrite-empathy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
        });
        const data = await resp.json();

        document.getElementById('originalText').textContent = data.original;
        document.getElementById('rewrittenText').textContent = data.rewritten;
        document.getElementById('originalScore').textContent = 'Score: ' + meterScore.textContent;
        document.getElementById('newScore').textContent = 'Score: ' + data.new_score + '%';
        lastRewrite = data.rewritten;

        rewriteResult.classList.add('visible');
    } catch (e) {
        console.error('Rewrite failed:', e);
    } finally {
        rewriteBtn.innerHTML = '‚ú® Rewrite with Empathy';
        rewriteBtn.disabled = false;
    }
});

// Use rewritten version
document.getElementById('useRewriteBtn').addEventListener('click', () => {
    if (lastRewrite) {
        composeInput.value = lastRewrite;
        charCount.textContent = lastRewrite.length;
        rewriteResult.classList.remove('visible');
        // Trigger re-analysis
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => analyzeLive(lastRewrite), 100);
    }
});

// Post button (simulated)
postBtn.addEventListener('click', () => {
    const text = composeInput.value.trim();
    if (!text) return;
    alert('‚úÖ Tweet posted safely!\n\n"' + text + '"');
    composeInput.value = '';
    charCount.textContent = '0';
    resetMeter();
});

// Example chips
document.querySelectorAll('.example-chip').forEach(chip => {
    chip.addEventListener('click', () => {
        const text = chip.getAttribute('data-text');
        composeInput.value = text;
        charCount.textContent = text.length;
        composeInput.focus();
        rewriteResult.classList.remove('visible');
        clearTimeout(debounceTimer);
        analyzeLive(text);
    });
});

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function escapeRegex(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}
</script>
</body>
</html>
